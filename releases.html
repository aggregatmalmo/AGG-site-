<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Releases — AGGREGAT</title>
  <style>
    :root{
      --ink:#111;
      --muted:#555;
      --page:#f6f6f6;
      --line:#e2e2e2;
      --pill:#ffffff;
      --pill-border:#cccccc;
      --pill-active:#000000;
      --gap:24px;
      --tile:340px; /* sleeve card width */
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--page); color:var(--ink);
      font-family:Arial,Helvetica,sans-serif; line-height:1.5;
    }

    /* Header (matches other pages) */
    header{
      position:fixed; top:0; left:0; right:0; z-index:40;
      padding:.8rem 0; border-bottom:1px solid #ddd;
      background:rgba(255,255,255,.78); backdrop-filter:blur(8px);
    }
    .container{width:min(1200px,92vw); margin:0 auto}
    .nav{display:flex; align-items:center; justify-content:space-between; gap:1rem}
    .brand{color:#111; font-weight:600; letter-spacing:.12em; text-transform:uppercase}
    .brand .dot{display:inline-block; width:.55rem; height:.55rem; background:#c7f37a; border-radius:999px; box-shadow:0 0 12px #c7f37a; margin-right:.5rem}
    .links{display:flex; gap:.6rem; align-items:center}
    .links a{
      display:inline-block; padding:.35rem .7rem; border-radius:999px;
      background:var(--pill); border:1px solid var(--pill-border);
      color:#000; font-weight:600; font-size:.8rem; text-decoration:none;
    }
    .links a.active{background:var(--pill-active); color:#fff; border-color:var(--pill-active);}

    main{padding-top:90px}
    h1{font-size:1.6rem; text-transform:uppercase; letter-spacing:.08em; margin:1.2rem 0 1.2rem}

    /* Carousel layout */
    .carousel{position:relative}
    .viewport{
      overflow:hidden;
      width:100%;
      padding:8px 0 18px;
    }
    .track{
      display:flex;
      gap:var(--gap);
      will-change:transform;
      transform:translate3d(0,0,0);
      transition:transform .5s ease;
    }
    .tile{
      width:var(--tile);
      flex:0 0 var(--tile);
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      padding:18px;
      box-shadow:0 16px 42px rgba(0,0,0,.12), 0 8px 18px rgba(0,0,0,.08);
      opacity:0; transform:translateY(30px);
      animation:fadeInUp .8s ease forwards;
    }
    /* Stagger only the originals; clones get no delays (JS will add class 'is-clone') */
    .tile:nth-of-type(1){animation-delay:.20s}
    .tile:nth-of-type(2){animation-delay:.40s}
    .tile:nth-of-type(3){animation-delay:.60s}
    .tile:nth-of-type(4){animation-delay:.80s}

    @keyframes fadeInUp { to { opacity:1; transform:translateY(0) } }

    /* Sleeve (square, spine, heavy layered shadow, gloss) */
    .sleeve{
      position:relative; background:#fff; overflow:hidden; border-radius:0;
      box-shadow:0 24px 60px rgba(0,0,0,.28), 0 10px 24px rgba(0,0,0,.18);
      transition:transform .3s ease, box-shadow .3s ease, filter .3s ease;
    }
    .sleeve img{display:block; width:100%; aspect-ratio:1/1; object-fit:cover}
    .sleeve::after{
      content:""; position:absolute; left:0; top:0; bottom:0; width:14px;
      background:linear-gradient(90deg, rgba(0,0,0,.20), rgba(0,0,0,0)); opacity:.38;
    }
    .sleeve::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background:linear-gradient(120deg,
        rgba(255,255,255,0.18) 0%,
        rgba(255,255,255,0.05) 45%,
        rgba(255,255,255,0) 60%);
      mix-blend-mode:screen; opacity:.7;
      transition:opacity .3s ease;
    }
    .tile:hover .sleeve{
      transform:translateY(-12px) scale(1.03);
      box-shadow:0 28px 80px rgba(0,0,0,.34), 0 14px 34px rgba(0,0,0,.22);
      filter:saturate(1.05);
    }
    .tile:hover .sleeve::before{opacity:1}

    .sticker{
      position:absolute; top:.6rem; right:.6rem; background:#fff;
      padding:.22rem .6rem; font-size:.74rem; font-weight:700;
      border-radius:999px; box-shadow:0 2px 6px rgba(0,0,0,.15)
    }
    .info{margin-top:12px}
    .cat{font-size:.8rem; font-weight:800; margin-bottom:.25rem}
    .artist{font-weight:800}
    .title{color:var(--muted); margin-top:2px}
    .btn{
      display:inline-block; margin-top:.7rem; padding:.42rem .9rem;
      border-radius:999px; background:#000; color:#fff; text-decoration:none;
      font-size:.8rem; font-weight:700;
    }

    /* Center focus styling */
    .tile.is-center .sleeve{
      transform:translateY(-6px) scale(1.04);
      box-shadow:0 30px 90px rgba(0,0,0,.36), 0 16px 38px rgba(0,0,0,.26);
      filter:saturate(1.06) contrast(1.04);
    }

    /* Arrows (fade until hover) */
    .arrow{
      position:absolute; top:50%; transform:translateY(-50%); z-index:5;
      width:42px; height:42px; border-radius:999px;
      border:1px solid var(--pill-border); background:#fff; color:#000;
      display:grid; place-items:center; cursor:pointer; user-select:none;
      box-shadow:0 6px 16px rgba(0,0,0,.12);
      opacity:0; transition:opacity .3s ease;
    }
    .carousel:hover .arrow{opacity:1}
    .arrow:hover{background:#000; color:#fff; border-color:#000}
    .arrow.left{left:-4px}
    .arrow.right{right:-4px}

    @media (max-width:760px){
      :root{ --tile:280px }
      .arrow{display:none} /* mobile uses swipe */
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="dot"></span>AGGREGAT</div>
      <nav class="links">
        <a href="index.html">Home</a>
        <a href="releases.html" class="active">Releases</a>
        <a href="about.html">About</a>
        <a href="https://instagram.com/aggregat040" target="_blank" rel="noopener">IG</a>
        <a href="#" target="_blank" rel="noopener">SC</a>
        <a href="#" target="_blank" rel="noopener">FB</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Releases</h1>

    <section class="carousel" id="carousel">
      <button class="arrow left" id="prevBtn" aria-label="Previous">‹</button>

      <div class="viewport" id="viewport">
        <div class="track" id="track">
          <!-- ORIGINALS: order these how you want -->
          <article class="tile">
            <div class="sleeve">
              <img src="assets/raft001.jpg" alt="AGG001 cover">
              <span class="sticker">AGG001 · 12”</span>
            </div>
            <div class="info">
              <div class="cat">AGG001</div>
              <div class="artist">Various Artists</div>
              <div class="title">RAFT001 Compilation</div>
              <a class="btn" href="#">Bandcamp</a>
            </div>
          </article>

          <article class="tile">
            <div class="sleeve">
              <img src="assets/raddler-express.jpg" alt="AGG002 cover">
              <span class="sticker">AGG002</span>
            </div>
            <div class="info">
              <div class="cat">AGG002</div>
              <div class="artist">Raddler Express</div>
              <div class="title">Express EP</div>
              <a class="btn" href="#">Bandcamp</a>
            </div>
          </article>

          <article class="tile">
            <div class="sleeve">
              <img src="assets/speedbump-vol2.jpg" alt="AGG003 cover">
              <span class="sticker">AGG003</span>
            </div>
            <div class="info">
              <div class="cat">AGG003</div>
              <div class="artist">Various Artists</div>
              <div class="title">Speed Bump Vol. 2</div>
              <a class="btn" href="#">Bandcamp</a>
            </div>
          </article>

          <article class="tile">
            <div class="sleeve">
              <img src="assets/t001.jpg" alt="AGG004 cover">
              <span class="sticker">AGG004</span>
            </div>
            <div class="info">
              <div class="cat">AGG004</div>
              <div class="artist">Various Artists</div>
              <div class="title">[T001]</div>
              <a class="btn" href="#">Bandcamp</a>
            </div>
          </article>
        </div>
      </div>

      <button class="arrow right" id="nextBtn" aria-label="Next">›</button>
    </section>
  </main>

  <script>
    // ===== Infinite, centered carousel =====
    const viewport = document.getElementById('viewport');
    const track = document.getElementById('track');
    const prev = document.getElementById('prevBtn');
    const next = document.getElementById('nextBtn');

    const GAP = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--gap')) || 24;
    let TILE = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--tile')) || 340;

    // 1) Clone slides before & after for seamless loop
    const originals = Array.from(track.children);
    const COUNT = originals.length;

    function cloneSet(where = 'after'){
      const clones = originals.map(node => {
        const c = node.cloneNode(true);
        c.classList.add('is-clone');
        return c;
      });
      if (where === 'after') clones.forEach(c => track.appendChild(c));
      else clones.reverse().forEach(c => track.insertBefore(c, track.firstChild));
    }
    cloneSet('before');
    cloneSet('after');

    // Current index starts at first original (after the before-clones)
    let current = COUNT; // index in track.children
    let tiles = Array.from(track.children);

    // 2) Position logic: center the current tile
    function tileFullWidth(){
      // tile width plus the CSS gap
      TILE = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--tile')) || tiles[0].getBoundingClientRect().width;
      return TILE + GAP;
    }
    function centerXFor(index){
      const vw = viewport.clientWidth;
      const w = tileFullWidth();
      const offset = index * w - (vw - TILE)/2;
      return -offset;
    }
    function applyTransform(immediate=false){
      const x = centerXFor(current);
      track.style.transition = immediate ? 'none' : 'transform .5s ease';
      track.style.transform = `translate3d(${x}px,0,0)`;
      highlightCenter();
      if (immediate) requestAnimationFrame(()=>track.style.transition='transform .5s ease');
    }

    // 3) Highlight the centered tile
    function highlightCenter(){
      tiles.forEach(t => t.classList.remove('is-center'));
      tiles[current]?.classList.add('is-center');
    }

    // 4) Jump when crossing clone boundaries (to keep it "infinite")
    function normalizeIndex(){
      if (current >= COUNT*2){ // went into trailing clones
        current -= COUNT;
        applyTransform(true);
      } else if (current < COUNT){ // went into leading clones
        current += COUNT;
        applyTransform(true);
      }
    }

    // 5) Controls
    function go(delta=1){
      current += delta;
      applyTransform(false);
      // after transition, normalize if needed
      clearTimeout(go._t);
      go._t = setTimeout(normalizeIndex, 520);
    }
    next.addEventListener('click', ()=>go(1));
    prev.addEventListener('click', ()=>go(-1));

    // 6) Keyboard accessibility
    window.addEventListener('keydown', (e)=>{
      if (e.key === 'ArrowRight') go(1);
      if (e.key === 'ArrowLeft')  go(-1);
    });

    // 7) Drag / swipe (basic)
    let dragging = false, startX = 0, lastX = 0;
    viewport.addEventListener('pointerdown', (e)=>{ dragging=true; startX=e.clientX; lastX=startX; viewport.setPointerCapture(e.pointerId); pauseAuto(); track.style.transition='none'; });
    viewport.addEventListener('pointermove', (e)=>{
      if(!dragging) return;
      const dx = e.clientX - lastX;
      lastX = e.clientX;
      const currentX = new WebKitCSSMatrix(getComputedStyle(track).transform).m41 || 0;
      track.style.transform = `translate3d(${currentX + dx}px,0,0)`;
    });
    viewport.addEventListener('pointerup', (e)=>{
      if(!dragging) return;
      dragging=false; track.style.transition='transform .5s ease';
      const moved = e.clientX - startX;
      const threshold = TILE*0.25; // 25% swipe to move
      if (moved < -threshold) go(1);
      else if (moved > threshold) go(-1);
      else applyTransform(false);
      resumeAuto();
    });

    // 8) Autoplay (waits until initial fade-in finishes)
    let auto=null;
    function pauseAuto(){ if(auto){ clearInterval(auto); auto=null; } }
    function resumeAuto(){ if(!auto){ auto=setInterval(()=>go(1), 4000); } }

    // Pause on hover
    const carousel = document.getElementById('carousel');
    carousel.addEventListener('mouseenter', pauseAuto);
    carousel.addEventListener('mouseleave', resumeAuto);

    // Start: center first original & then autoplay after intro anim
    function initial(){
      tiles = Array.from(track.children);
      applyTransform(true);
      highlightCenter();
      // start autoplay after the entry animations end
      setTimeout(resumeAuto, 1200);
    }
    // Re-center on resize
    window.addEventListener('resize', ()=>applyTransform(true));

    initial();
  </script>
</body>
</html>
